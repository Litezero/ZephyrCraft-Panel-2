# 玩家管理功能测试文档

## 功能概述

新的玩家管理系统不再依赖`list`命令来获取玩家列表，而是通过解析服务器控制台输出来实时跟踪玩家连接和断开事件。

## 主要特性

### 1. 自动玩家检测
- **连接检测**: 解析 `Player connected: [玩家名], xuid: [XUID]` 格式的日志
- **断开检测**: 解析 `Player disconnected: [玩家名], xuid: [XUID], pfid: [PFID]` 格式的日志
- **正则匹配**: 使用正则表达式匹配，兼容不同版本的输出格式

### 2. 服务端玩家管理
- **内存存储**: 玩家列表存储在Go后端内存中
- **实时更新**: 玩家连接/断开时立即更新列表
- **并发安全**: 使用读写锁保护玩家列表的并发访问

### 3. 前端功能
- **实时显示**: 玩家列表实时更新，无需手动刷新
- **玩家信息**: 显示玩家名称和XUID（如果有）
- **操作功能**: 支持发送消息和踢出玩家
- **状态管理**: 服务器状态变化时自动清空玩家列表

## 测试步骤

### 1. 启动服务器
1. 启动Go后端服务
2. 启动前端应用
3. 连接到服务器
4. 启动Minecraft服务器

### 2. 测试玩家连接
1. 让玩家连接到Minecraft服务器
2. 观察控制台输出是否包含：`Player connected: [玩家名], xuid: [XUID]`
3. 检查前端玩家页面是否显示新连接的玩家
4. 验证玩家信息是否正确显示（名称和XUID）

### 3. 测试玩家断开
1. 让玩家断开连接
2. 观察控制台输出是否包含：`Player disconnected: [玩家名], xuid: [XUID], pfid: [PFID]`
3. 检查前端玩家页面是否移除断开的玩家

### 4. 测试服务器重启
1. 停止Minecraft服务器
2. 检查前端玩家列表是否清空
3. 重新启动服务器
4. 验证玩家列表保持清空状态

### 5. 测试玩家操作
1. 点击玩家列表中的"消息"按钮
2. 输入消息并发送
3. 验证命令是否正确发送到服务器
4. 点击"踢出"按钮
5. 验证踢出命令是否正确发送

## 预期行为

### 正常情况
- ✅ 玩家连接时，前端立即显示新玩家
- ✅ 玩家断开时，前端立即移除玩家
- ✅ 玩家信息包含名称和XUID（如果有）
- ✅ 服务器重启时清空玩家列表
- ✅ 玩家操作按钮正常工作

### 异常情况
- ⚠️ 如果控制台输出格式不匹配，玩家事件不会被检测
- ⚠️ 如果网络断开，玩家列表不会更新
- ⚠️ 如果服务器崩溃，玩家列表可能不会清空

## 调试信息

### 后端日志
- `[PlayerManager] 玩家加入: [玩家名] (XUID: [XUID]), 当前在线: [数量]`
- `[PlayerManager] 玩家离开: [玩家名], 当前在线: [数量]`
- `[PlayerManager] 玩家列表已清空`

### 前端日志
- `Players: Requesting players list, wsApi: [状态], isConnected: [状态]`
- `Players: Sending getPlayers command`
- `Players: Received players list: [玩家列表]`

## 技术实现

### 后端文件
- `Server/playerManager.go`: 玩家管理器实现
- `Server/Main.go`: 添加玩家列表消息处理
- `Server/ProcessManager.go`: 集成玩家事件解析

### 前端文件
- `Client/Tauri/src/components/console/Players.vue`: 玩家页面组件
- `Client/Tauri/src/views/Home.vue`: 消息分发逻辑

### 消息格式
```json
{
  "players": [
    {
      "name": "玩家名",
      "xuid": "XUID值"
    }
  ]
}
```

## 注意事项

1. **正则表达式**: 当前支持的标准格式，如果服务器输出格式变化需要调整
2. **内存管理**: 玩家列表存储在内存中，服务器重启会清空
3. **并发安全**: 使用读写锁确保多线程环境下的数据一致性
4. **错误处理**: 网络错误或解析错误不会影响服务器正常运行 